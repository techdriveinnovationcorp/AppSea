import{A as Qr,B as vt,C as L,D as fe,E as ln,F as _i,G as Yr,H as qe,I as wt,J as Xr,K as Zr,L as we,M as V,a as f,b as ze,c as rn,d as Ur,e as Br,f as D,g as jr,h as di,i as Vr,j as oe,k as Hr,l as Gr,m as on,n as P,o as Kr,p as $r,q as X,r as ve,s as an,t as yt,u as zr,v as qr,w as g,x as j,y as x,z as fi}from"./chunk-4JSTVPM3.js";import{$ as me,$a as ye,$b as hi,A as Ar,Ac as Wr,Ea as $e,I as Rr,K as Nr,N as li,O as Pr,Ob as Fr,P as ci,Pb as Lr,R as xr,T as de,U as ui,W as Dr,X as Or,aa as gt,c as Ge,ca as $,ea as C,f as br,ga as Mr,h as sn,i as kr,k as xe,l as Ke,la as mt,m as ai,n as De,r as K,z as pt}from"./chunk-FKFXYT3U.js";import{a as nn,b as Sr,f as re}from"./chunk-U2X4XRB7.js";var Wl="firebase",Ul="10.13.1";we(Wl,Ul,"app");var Qe=new Fr("ANGULARFIRE2_VERSION");var Bl=(n,e)=>{let t=e?[e]:Zr(),i=[];return t.forEach(s=>{s.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},Oe=class{constructor(){return Bl(jl)}},jl="app-check";function pi(){}var cn=class{zone;delegate;constructor(e,t=kr){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let s=this.zone,r=function(o){s.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(r,t,i)}},gi=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",pi,{},pi,pi)),t.pipe(Dr({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},hn=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new cn(Zone.current)),this.insideAngular=t.run(()=>new cn(Zone.current,sn)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(C(ye))};static \u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Vl(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function _e(n){return Hl(Vl())(n)}function Hl(n){return function(t){return t=t.lift(new gi(n.ngZone)),t.pipe(Ke(n.outsideAngular),xe(n.insideAngular))}}var Gl="firebase",Kl="10.13.1";V.registerVersion(Gl,Kl,"app-compat");var $l=["ngOnDestroy"],to=(n,e,t,i={})=>new Proxy(n,{get:(s,r)=>t.runOutsideAngular(()=>{if(n[r])return i?.spy?.get&&i.spy.get(r,n[r]),n[r];if($l.indexOf(r)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[r];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let h=u?.(...c);return i?.spy?.apply&&i.spy.apply(r,c,h),h})})})});var dn=class{constructor(e){return e}},Ye=new $("angularfire2.app.options"),Xe=new $("angularfire2.app.name");function Et(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",s=typeof t=="object"&&t||{};s.name=s.name||i;let o=V.apps.filter(a=>a&&a.name===s.name)[0]||e.runOutsideAngular(()=>V.initializeApp(n,s));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;zl("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new dn(o)}var zl=(n,...e)=>{hi()&&typeof console<"u"&&console[n](...e)},ql={provide:dn,useFactory:Et,deps:[Ye,ye,[new Mr,Xe]]},Gd=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:Ye,useValue:t},{provide:Xe,useValue:i}]}}constructor(t){V.registerVersion("angularfire",Qe.full,"core"),V.registerVersion("angularfire",Qe.full,"app-compat"),V.registerVersion("angular",Lr.full,t.toString())}static \u0275fac=function(i){return new(i||n)(C($e))};static \u0275mod=mt({type:n});static \u0275inj=gt({providers:[ql]})}return n})();function fn(n,e,t,i,s){let[,r,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(r)return Ql(s,o)||(eo("error",`${e} was already initialized on the ${t} Firebase App with different settings.${Yl?" You may need to reload as Firebase is not HMR aware.":""}`),eo("warn",{is:s,was:o})),r;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,s]),a}}function Ql(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var Yl=typeof module<"u"&&!!module.hot,eo=(n,...e)=>{hi()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Jl=new Map,ec={activated:!1,tokenObservers:[]},tc={initialized:!1,enabled:!1};function ne(n){return Jl.get(n)||Object.assign({},ec)}function oo(){return tc}var nc="https://content-firebaseappcheck.googleapis.com/v1";var ic="exchangeDebugToken",no={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},ef=24*60*60*1e3;var yi=class{constructor(e,t,i,s,r){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=s,this.upperBound=r,this.pending=null,this.nextErrorWaitInterval=s,s>r)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return re(this,null,function*(){this.stop();try{this.pending=new D,this.pending.promise.catch(t=>{}),yield sc(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new D,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function sc(n){return new Promise(e=>{setTimeout(e,n)})}var rc={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Ee=new Gr("appCheck","AppCheck",rc);function ao(n){if(!ne(n).activated)throw Ee.create("use-before-activation",{appName:n.name})}function lo(i,s){return re(this,arguments,function*({url:n,body:e},t){let r={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let _=yield o.getHeartbeatsHeader();_&&(r["X-Firebase-Client"]=_)}let a={method:"POST",body:JSON.stringify(e),headers:r},l;try{l=yield fetch(n,a)}catch(_){throw Ee.create("fetch-network-error",{originalErrorMessage:_?.message})}if(l.status!==200)throw Ee.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(_){throw Ee.create("fetch-parse-error",{originalErrorMessage:_?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Ee.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(u[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function co(n,e){let{projectId:t,appId:i,apiKey:s}=n.options;return{url:`${nc}/projects/${t}/apps/${i}:${ic}?key=${s}`,body:{debug_token:e}}}var oc="firebase-app-check-database",ac=1,vi="firebase-app-check-store";var _n=null;function lc(){return _n||(_n=new Promise((n,e)=>{try{let t=indexedDB.open(oc,ac);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var s;e(Ee.create("storage-open",{originalErrorMessage:(s=i.target.error)===null||s===void 0?void 0:s.message}))},t.onupgradeneeded=i=>{let s=i.target.result;switch(i.oldVersion){case 0:s.createObjectStore(vi,{keyPath:"compositeKey"})}}}catch(t){e(Ee.create("storage-open",{originalErrorMessage:t?.message}))}}),_n)}function cc(n,e){return uc(hc(n),e)}function uc(n,e){return re(this,null,function*(){let i=(yield lc()).transaction(vi,"readwrite"),r=i.objectStore(vi).put({compositeKey:n,value:e});return new Promise((o,a)=>{r.onsuccess=l=>{o()},i.onerror=l=>{var c;a(Ee.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function hc(n){return`${n.options.appId}-${n.name}`}var wi=new qe("@firebase/app-check");function mi(n,e){return Hr()?cc(n,e).catch(t=>{wi.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function uo(){return oo().enabled}function ho(){return re(this,null,function*(){let n=oo();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var dc={error:"UNKNOWN_ERROR"};function fc(n){return rn.encodeString(JSON.stringify(n),!1)}function Ei(n,e=!1){return re(this,null,function*(){let t=n.app;ao(t);let i=ne(t),s=i.token,r;if(s&&!Ct(s)&&(i.token=void 0,s=void 0),!s){let l=yield i.cachedTokenPromise;l&&(Ct(l)?s=l:yield mi(t,void 0))}if(!e&&s&&Ct(s))return{token:s.token};let o=!1;if(uo()){i.exchangeTokenPromise||(i.exchangeTokenPromise=lo(co(t,yield ho()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let l=yield i.exchangeTokenPromise;return yield mi(t,l),i.token=l,{token:l.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),s=yield ne(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?wi.warn(l.message):wi.error(l),r=l}let a;return s?r?Ct(s)?a={token:s.token,internalError:r}:a=so(r):(a={token:s.token},i.token=s,yield mi(t,s)):a=so(r),o&&mc(t,a),a})}function _c(n){return re(this,null,function*(){let e=n.app;ao(e);let{provider:t}=ne(e);if(uo()){let i=yield ho(),{token:s}=yield lo(co(e,i),n.heartbeatServiceProvider);return{token:s}}else{let{token:i}=yield t.getToken();return{token:i}}})}function pc(n,e,t,i){let{app:s}=n,r=ne(s),o={next:t,error:i,type:e};if(r.tokenObservers=[...r.tokenObservers,o],r.token&&Ct(r.token)){let a=r.token;Promise.resolve().then(()=>{t({token:a.token}),io(n)}).catch(()=>{})}r.cachedTokenPromise.then(()=>io(n))}function fo(n,e){let t=ne(n),i=t.tokenObservers.filter(s=>s.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function io(n){let{app:e}=n,t=ne(e),i=t.tokenRefresher;i||(i=gc(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function gc(n){let{app:e}=n;return new yi(()=>re(this,null,function*(){let t=ne(e),i;if(t.token?i=yield Ei(n,!0):i=yield Ei(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=ne(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,s=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,s),Math.max(0,i-Date.now())}else return 0},no.RETRIAL_MIN_WAIT,no.RETRIAL_MAX_WAIT)}function mc(n,e){let t=ne(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function Ct(n){return n.expireTimeMillis-Date.now()>0}function so(n){return{token:fc(dc),error:n}}var Ci=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=ne(this.app);for(let t of e)fo(this.app,t.next);return Promise.resolve()}};function yc(n,e){return new Ci(n,e)}function vc(n){return{getToken:e=>Ei(n,e),getLimitedUseToken:()=>_c(n),addTokenListener:e=>pc(n,"INTERNAL",e),removeTokenListener:e=>fo(n.app,e)}}var wc="@firebase/app-check",Ec="0.8.7";var Cc="app-check",ro="app-check-internal";function Tc(){wt(new fe(Cc,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return yc(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(ro).initialize()})),wt(new fe(ro,n=>{let e=n.getProvider("app-check").getImmediate();return vc(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),we(wc,Ec)}Tc();var Ic=["localhost","0.0.0.0","127.0.0.1"],ff=typeof window<"u"&&Ic.includes(window.location.hostname);var Ti=new $("angularfire2.auth.use-emulator"),Ii=new $("angularfire2.auth.settings"),Si=new $("angularfire2.auth.tenant-id"),bi=new $("angularfire2.auth.langugage-code"),ki=new $("angularfire2.auth.use-device-language"),Ai=new $("angularfire.auth.persistence"),Ri=(n,e,t,i,s,r,o,a)=>fn(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),i&&(l.tenantId=i),l.languageCode=s,r&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,i,s,r,o,a]),po=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,i,s,r,o,a,l,c,u,h,d,_){let p=new br,E=De(void 0).pipe(xe(o.outsideAngular),de(()=>r.runOutsideAngular(()=>import("./chunk-5JFCYHJL.js"))),K(()=>Et(t,r,i)),K(S=>Ri(S,r,a,c,u,h,l,d)),ci({bufferSize:1,refCount:!1}));if(Wr(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=De(null);else{E.pipe(Nr()).subscribe();let S=E.pipe(de(A=>A.getRedirectResult().then(te=>te,()=>null)),_e,ci({bufferSize:1,refCount:!1})),H=E.pipe(de(A=>new Ge(te=>({unsubscribe:r.runOutsideAngular(()=>A.onAuthStateChanged(Pe=>te.next(Pe),Pe=>te.error(Pe),()=>te.complete()))})))),G=E.pipe(de(A=>new Ge(te=>({unsubscribe:r.runOutsideAngular(()=>A.onIdTokenChanged(Pe=>te.next(Pe),Pe=>te.error(Pe),()=>te.complete()))}))));this.authState=S.pipe(ui(H),Ke(o.outsideAngular),xe(o.insideAngular)),this.user=S.pipe(ui(G),Ke(o.outsideAngular),xe(o.insideAngular)),this.idToken=this.user.pipe(de(A=>A?ai(A.getIdToken()):De(null))),this.idTokenResult=this.user.pipe(de(A=>A?ai(A.getIdTokenResult()):De(null))),this.credential=pt(S,p,this.authState.pipe(Ar(A=>!A))).pipe(K(A=>A?.user?A:null),Ke(o.outsideAngular),xe(o.insideAngular))}return to(this,E,r,{spy:{apply:(S,H,G)=>{(S.startsWith("signIn")||S.startsWith("createUser"))&&G.then(A=>p.next(A))}}})}static \u0275fac=function(i){return new(i||n)(C(Ye),C(Xe,8),C($e),C(ye),C(hn),C(Ti,8),C(Ii,8),C(Si,8),C(bi,8),C(ki,8),C(Ai,8),C(Oe,8))};static \u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var go="@firebase/database",mo="1.0.7";var js="";function Vs(n){js=n}var Li=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),P(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:on(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Wi=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return X(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var qo=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Li(e)}}catch{}return new Wi},Fe=qo("localStorage"),Ui=qo("sessionStorage");var tt=new qe("@firebase/database"),Qo=function(){let n=1;return function(){return n++}}(),Yo=function(n){let e=Qr(n),t=new qr;t.update(e);let i=t.digest();return rn.encodeByteArray(i)},$t=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=$t.apply(null,i):typeof i=="object"?e+=P(i):e+=i,e+=" "}return e},Le=null,yo=!0,Xo=function(n,e){f(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(tt.logLevel=Yr.VERBOSE,Le=tt.log.bind(tt),e&&Ui.set("logging_enabled",!0)):typeof n=="function"?Le=n:(Le=null,Ui.remove("logging_enabled"))},O=function(...n){if(yo===!0&&(yo=!1,Le===null&&Ui.get("logging_enabled")===!0&&Xo(!0)),Le){let e=$t.apply(null,n);Le(e)}},zt=function(n){return function(...e){O(n,...e)}},Bi=function(...n){let e="FIREBASE INTERNAL ERROR: "+$t(...n);tt.error(e)},ce=function(...n){let e=`FIREBASE FATAL ERROR: ${$t(...n)}`;throw tt.error(e),new Error(e)},F=function(...n){let e="FIREBASE WARNING: "+$t(...n);tt.warn(e)},bc=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&F("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Vn=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},kc=function(n){if(oe()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Se="[MIN_NAME]",pe="[MAX_NAME]",Ue=function(n,e){if(n===e)return 0;if(n===Se||e===pe)return-1;if(e===Se||n===pe)return 1;{let t=vo(n),i=vo(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},Ac=function(n,e){return n===e?0:n<e?-1:1},Tt=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+P(e))},Hs=function(n){if(typeof n!="object"||n===null)return P(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=P(e[i]),t+=":",t+=Hs(n[e[i]]);return t+="}",t},Zo=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function M(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var Jo=function(n){f(!Vn(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,s,r,o,a,l;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();let u=c.join(""),h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},Rc=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Nc=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Pc(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var xc=new RegExp("^-?(0*)\\d{1,10}$"),Dc=-2147483648,Oc=2147483647,vo=function(n){if(xc.test(n)){let e=Number(n);if(e>=Dc&&e<=Oc)return e}return null},ut=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw F("Exception was thrown by user callback.",t),e},Math.floor(0))}},Mc=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},kt=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var ji=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){F(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Vi=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(O("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',F(e)}},At=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),gn="5",ea="v",ta="s",na="r",ia="f",sa=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ra="ls",oa="p",Hi="ac",aa="websocket",la="long_polling";var mn=class{constructor(e,t,i,s,r=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Fe.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Fe.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function Fc(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ca(n,e,t){f(typeof e=="string","typeof type must == string"),f(typeof t=="object","typeof params must == object");let i;if(e===aa)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===la)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Fc(n)&&(t.ns=n.namespace);let s=[];return M(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}var Gi=class{constructor(){this.counters_={}}incrementCounter(e,t=1){X(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Br(this.counters_)}};var Ni={},Pi={};function Gs(n){let e=n.toString();return Ni[e]||(Ni[e]=new Gi),Ni[e]}function Lc(n,e){let t=n.toString();return Pi[t]||(Pi[t]=e()),Pi[t]}var Ki=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&ut(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var wo="start",Wc="close",Uc="pLPCommand",Bc="pRTLPCB",ua="id",ha="pw",da="ser",jc="cb",Vc="seg",Hc="ts",Gc="d",Kc="dframe",fa=1870,_a=30,$c=fa-_a,zc=25e3,qc=3e4,xt=class n{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=zt(e),this.stats_=Gs(t),this.urlFn=l=>(this.appCheckToken&&(l[Hi]=this.appCheckToken),ca(t,la,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ki(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(qc)),kc(()=>{if(this.isClosed_)return;this.scriptTagHolder=new $i((...r)=>{let[o,a,l,c,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===wo)this.id=a,this.password=l;else if(o===Wc)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[wo]="t",i[da]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[jc]=this.scriptTagHolder.uniqueCallbackIdentifier),i[ea]=gn,this.transportSessionId&&(i[ta]=this.transportSessionId),this.lastSessionId&&(i[ra]=this.lastSessionId),this.applicationId&&(i[oa]=this.applicationId),this.appCheckToken&&(i[Hi]=this.appCheckToken),typeof location<"u"&&location.hostname&&sa.test(location.hostname)&&(i[na]=ia);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return oe()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Rc()&&!Nc()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=P(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=Ur(t),s=Zo(i,$c);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(oe())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[Kc]="t",i[ua]=e,i[ha]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=P(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},$i=class n{constructor(e,t,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,oe())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Qo(),window[Uc+this.uniqueCallbackIdentifier]=e,window[Bc+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){O("frame writing exception"),a.stack&&O(a.stack),O(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||O("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[ua]=this.myID,e[ha]=this.myPW,e[da]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+_a+i.length<=fa;){let o=this.pendingSegs.shift();i=i+"&"+Vc+s+"="+o.seg+"&"+Hc+s+"="+o.ts+"&"+Gc+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(zc)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){oe()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{O("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var Qc=16384,Yc=45e3,yn=null;typeof MozWebSocket<"u"?yn=MozWebSocket:typeof WebSocket<"u"&&(yn=WebSocket);var Je=(()=>{class n{constructor(t,i,s,r,o,a,l){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=zt(this.connId),this.stats_=Gs(i),this.connURL=n.connectionURL_(i,a,l,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,s,r,o){let a={};return a[ea]=gn,!oe()&&typeof location<"u"&&location.hostname&&sa.test(location.hostname)&&(a[na]=ia),i&&(a[ta]=i),s&&(a[ra]=s),r&&(a[Hi]=r),o&&(a[oa]=o),ca(t,aa,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Fe.set("previous_websocket_failure",!0);try{let s;if(oe()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${gn}/${js}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new yn(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(i);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&yn!==null&&!n.forceDisallow_}static previouslyFailed(){return Fe.isInMemoryStorage||Fe.get("previous_websocket_failure")===!0}markConnectionHealthy(){Fe.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let s=on(i);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(f(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let s=this.extractFrameCount_(i);s!==null&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();let i=P(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let s=Zo(i,Qc);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Yc))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),pa=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[xt,Je]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let i=Je&&Je.isAvailable(),s=i&&!Je.previouslyFailed();if(t.webSocketOnly&&(i||F("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Je];else{let r=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Xc=6e4,Zc=5e3,Jc=10*1024,eu=100*1024,xi="t",Eo="d",tu="s",Co="r",nu="e",To="o",Io="a",So="n",bo="p",iu="h",zi=class{constructor(e,t,i,s,r,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=zt("c:"+this.id+":"),this.transportManager_=new pa(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=kt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>eu?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Jc?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(xi in e){let t=e[xi];t===Io?this.upgradeIfSecondaryHealthy_():t===Co?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===To&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=Tt("t",e),i=Tt("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:bo,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Io,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:So,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=Tt("t",e),i=Tt("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=Tt(xi,e);if(Eo in e){let i=e[Eo];if(t===iu){let s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===So){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===tu?this.onConnectionShutdown_(i):t===Co?this.onReset_(i):t===nu?Bi("Server Error: "+i):t===To?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Bi("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),gn!==i&&F("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),kt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Xc))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):kt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Zc))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:bo,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Fe.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var vn=class{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var wn=class{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var En=class n extends wn{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!di()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return f(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var ko=32,Ao=768,I=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function T(){return new I("")}function y(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function be(n){return n.pieces_.length-n.pieceNum_}function b(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new I(n.pieces_,e)}function Ks(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function su(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Dt(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function ga(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new I(e,0)}function R(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof I)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new I(t,0)}function v(n){return n.pieceNum_>=n.pieces_.length}function W(n,e){let t=y(n),i=y(e);if(t===null)return e;if(t===i)return W(b(n),b(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function ru(n,e){let t=Dt(n,0),i=Dt(e,0);for(let s=0;s<t.length&&s<i.length;s++){let r=Ue(t[s],i[s]);if(r!==0)return r}return t.length===i.length?0:t.length<i.length?-1:1}function $s(n,e){if(be(n)!==be(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Z(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(be(n)>be(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var qi=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Dt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=vt(this.parts_[i]);ma(this)}};function ou(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=vt(e),ma(n)}function au(n){let e=n.parts_.pop();n.byteLength_-=vt(e),n.parts_.length>0&&(n.byteLength_-=1)}function ma(n){if(n.byteLength_>Ao)throw new Error(n.errorPrefix_+"has a key path longer than "+Ao+" bytes ("+n.byteLength_+").");if(n.parts_.length>ko)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ko+") or object contains a cycle "+Me(n))}function Me(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Qi=class n extends wn{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new n}getInitialEvent(e){return f(e==="visible","Unknown event type: "+e),[this.visible_]}};var It=1e3,lu=60*5*1e3,Ro=30*1e3,cu=1.3,uu=3e4,hu="server_kill",No=3,zs=(()=>{class n extends vn{constructor(t,i,s,r,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=zt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=It,this.maxReconnectDelay_=lu,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!oe())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Qi.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&En.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,s){let r=++this.requestNumber_,o={r,a:t,b:i};this.log_(P(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();let i=new D,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?i.resolve(l):i.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,s,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:i,query:t,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(t){let i=t.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(s,r),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&X(t,"w")){let s=ve(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();F(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||$r(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Ro)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=Kr(t)?"auth":"gauth",s={cred:t};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,s=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(t,i){let s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,i)}sendUnlisten_(t,i,s,r){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:s})}onDisconnectMerge(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:s})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,s,r){let o={p:i,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,i,s,r){this.putInternal("p",t,i,s,r)}merge(t,i,s,r){this.putInternal("m",t,i,s,r)}putInternal(t,i,s,r,o){this.initConnection_();let a={p:i,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+P(t));let i=t.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):Bi("Unrecognized action received from server: "+P(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=It,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=It,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>uu&&(this.reconnectDelay_=It),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*cu)}this.onConnectStatus_(!1)}establishConnection_(){return re(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,s())},u=function(d){f(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,_]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?O("getToken() completed but was canceled"):(O("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=_&&_.token,l=new zi(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,s,p=>{F(p+" ("+this.repoInfo_.toString()+")"),this.interrupt(hu)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&F(d),c())}}})}interrupt(t){O("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){O("Resuming connection for reason: "+t),delete this.interruptReasons_[t],an(this.interruptReasons_)&&(this.reconnectDelay_=It,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let s;i?s=i.map(o=>Hs(o)).join("$"):s="default";let r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,i){let s=new I(t).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(i),o.delete(i),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,i){O("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=No&&(this.reconnectDelay_=Ro,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){O("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=No&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";oe()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+js.replace(/\./g,"-")]=1,di()?t["framework.cordova"]=1:Vr()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=En.getInstance().currentlyOnline();return an(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),w=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var nt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new w(Se,e),s=new w(Se,t);return this.compare(i,s)!==0}minPost(){return w.MIN}};var pn,Cn=class extends nt{static get __EMPTY_NODE(){return pn}static set __EMPTY_NODE(e){pn=e}compare(e,t){return Ue(e.name,t.name)}isDefinedOn(e){throw ze("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return w.MIN}maxPost(){return new w(pe,pn)}makePost(e,t){return f(typeof e=="string","KeyIndex indexValue must always be a string."),new w(e,pn)}toString(){return".key"}},le=new Cn;var et=class{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},ie=(()=>{class n{constructor(t,i,s,r,o){this.key=t,this.value=i,this.color=s??n.RED,this.left=r??J.EMPTY_NODE,this.right=o??J.EMPTY_NODE}copy(t,i,s,r,o){return new n(t??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,s){let r=this,o=s(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,i,s),null):o===0?r=r.copy(null,i,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return J.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let s,r;if(s=this,i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),i(t,s.key)===0){if(s.right.isEmpty())return J.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Yi=class{copy(e,t,i,s,r){return this}insert(e,t,i){return new ie(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},J=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ie.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ie.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new et(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new et(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new et(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new et(this.root_,null,this.comparator_,!0,e)}};J.EMPTY_NODE=new Yi;function du(n,e){return Ue(n.name,e.name)}function qs(n,e){return Ue(n,e)}var Xi;function fu(n){Xi=n}var ya=function(n){return typeof n=="number"?"number:"+Jo(n):"string:"+n},va=function(n){if(n.isLeafNode()){let e=n.val();f(typeof e=="string"||typeof e=="number"||typeof e=="object"&&X(e,".sv"),"Priority must be a string or number.")}else f(n===Xi||n.isEmpty(),"priority of unexpected type.");f(n===Xi||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Po,it=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),va(this.priorityNode_)}static set __childrenNodeConstructor(t){Po=t}static get __childrenNodeConstructor(){return Po}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return v(t)?this:y(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let s=y(t);return s===null?i:i.isEmpty()&&s!==".priority"?this:(f(s!==".priority"||be(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(b(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+ya(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=Jo(this.value_):t+=this.value_,this.lazyHash_=Yo(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(f(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return f(r>=0,"Unknown leaf type: "+i),f(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),wa,Ea;function _u(n){wa=n}function pu(n){Ea=n}var Zi=class extends nt{compare(e,t){let i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?Ue(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return w.MIN}maxPost(){return new w(pe,new it("[PRIORITY-POST]",Ea))}makePost(e,t){let i=wa(e);return new w(t,new it("[PRIORITY-POST]",i))}toString(){return".priority"}},k=new Zi;var gu=Math.log(2),Ji=class{constructor(e){let t=r=>parseInt(Math.log(r)/gu,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Tn=function(n,e,t,i){n.sort(e);let s=function(l,c){let u=c-l,h,d;if(u===0)return null;if(u===1)return h=n[l],d=t?t(h):h,new ie(d,h.node,ie.BLACK,null,null);{let _=parseInt(u/2,10)+l,p=s(l,_),E=s(_+1,c);return h=n[_],d=t?t(h):h,new ie(d,h.node,ie.BLACK,p,E)}},r=function(l){let c=null,u=null,h=n.length,d=function(p,E){let S=h-p,H=h;h-=p;let G=s(S+1,H),A=n[S],te=t?t(A):A;_(new ie(te,A.node,E,null,G))},_=function(p){c?(c.left=p,c=p):(u=p,c=p)};for(let p=0;p<l.count;++p){let E=l.nextBitIsOne(),S=Math.pow(2,l.count-(p+1));E?d(S,ie.BLACK):(d(S,ie.BLACK),d(S,ie.RED))}return u},o=new Ji(n.length),a=r(o);return new J(i||e,a)};var Di,Ze={},st=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f(Ze&&k,"ChildrenNode.ts has not been loaded"),Di=Di||new n({".priority":Ze},{".priority":k}),Di}get(e){let t=ve(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof J?t:null}hasIndex(e){return X(this.indexSet_,e.toString())}addIndex(e,t){f(e!==le,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=t.getIterator(w.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=Tn(i,e.getCompare()):a=Ze;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new n(u,c)}addToIndexes(e,t){let i=yt(this.indexes_,(s,r)=>{let o=ve(this.indexSet_,r);if(f(o,"Missing index implementation for "+r),s===Ze)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(w.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Tn(a,o.getCompare())}else return Ze;else{let a=t.get(e.name),l=s;return a&&(l=l.remove(new w(e.name,a))),l.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=yt(this.indexes_,s=>{if(s===Ze)return s;{let r=t.get(e.name);return r?s.remove(new w(e.name,r)):s}});return new n(i,this.indexSet_)}};var St,m=(()=>{class n{constructor(t,i,s){this.children_=t,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&va(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return St||(St=new n(new J(qs),null,st.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||St}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?St:i}}getChild(t){let i=y(t);return i===null?this:this.getImmediateChild(i).getChild(b(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(f(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let s=new w(t,i),r,o;i.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?St:this.priorityNode_;return new n(r,a,o)}}updateChild(t,i){let s=y(t);if(s===null)return i;{f(y(t)!==".priority"||be(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(b(t),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},s=0,r=0,o=!0;if(this.forEachChild(k,(a,l)=>{i[a]=l.val(t),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){let a=[];for(let l in i)a[l]=i[l];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+ya(this.getPriority().val())+":"),this.forEachChild(k,(i,s)=>{let r=s.hash();r!==""&&(t+=":"+i+":"+r)}),this.lazyHash_=t===""?"":Yo(t)}return this.lazyHash_}getPredecessorChildName(t,i,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new w(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new w(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new w(i,this.children_.get(i)):null}forEachChild(t,i){let s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,w.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,w.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===qt?-1:0}withIndex(t){if(t===le||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===le||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let s=this.getIterator(k),r=i.getIterator(k),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===le?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),es=class extends m{constructor(){super(new J(qs),m.EMPTY_NODE,st.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return m.EMPTY_NODE}isEmpty(){return!1}},qt=new es;Object.defineProperties(w,{MIN:{value:new w(Se,m.EMPTY_NODE)},MAX:{value:new w(pe,qt)}});Cn.__EMPTY_NODE=m.EMPTY_NODE;it.__childrenNodeConstructor=m;fu(qt);pu(qt);var mu=!0;function N(n,e=null){if(n===null)return m.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),f(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new it(t,N(e))}if(!(n instanceof Array)&&mu){let t=[],i=!1;if(M(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=N(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new w(o,l)))}}),t.length===0)return m.EMPTY_NODE;let r=Tn(t,du,o=>o.name,qs);if(i){let o=Tn(t,k.getCompare());return new m(r,N(e),new st({".priority":o},{".priority":k}))}else return new m(r,N(e),st.Default)}else{let t=m.EMPTY_NODE;return M(n,(i,s)=>{if(X(n,i)&&i.substring(0,1)!=="."){let r=N(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(N(e))}}_u(N);var Ot=class extends nt{constructor(e){super(),this.indexPath_=e,f(!v(e)&&y(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?Ue(e.name,t.name):r}makePost(e,t){let i=N(e),s=m.EMPTY_NODE.updateChild(this.indexPath_,i);return new w(t,s)}maxPost(){let e=m.EMPTY_NODE.updateChild(this.indexPath_,qt);return new w(pe,e)}toString(){return Dt(this.indexPath_,0).join("/")}};var ts=class extends nt{compare(e,t){let i=e.node.compareTo(t.node);return i===0?Ue(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return w.MIN}maxPost(){return w.MAX}makePost(e,t){let i=N(e);return new w(t,i)}toString(){return".value"}},Qs=new ts;function Ca(n){return{type:"value",snapshotNode:n}}function rt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Mt(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ft(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function yu(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Lt=class{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(Mt(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(rt(t,i)):o.trackChildChange(Ft(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(k,(s,r)=>{t.hasChild(s)||i.trackChildChange(Mt(s,r))}),t.isLeafNode()||t.forEachChild(k,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(Ft(s,r,o))}else i.trackChildChange(rt(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?m.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var In=class n{constructor(e){this.indexedFilter_=new Lt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new w(t,i))||(i=m.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=m.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(m.EMPTY_NODE);let r=this;return t.forEachChild(k,(o,a)=>{r.matches(new w(o,a))||(s=s.updateImmediateChild(o,m.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var ns=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new In(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new w(t,i))||(i=m.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=m.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=m.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(m.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,m.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){let h=this.index_.getCompare();o=(d,_)=>h(_,d)}else o=this.index_.getCompare();let a=e;f(a.numChildren()===this.limit_,"");let l=new w(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let h=a.getImmediateChild(t),d=s.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=s.getChildAfterChild(this.index_,d,this.reverse_);let _=d==null?1:o(d,l);if(u&&!i.isEmpty()&&_>=0)return r?.trackChildChange(Ft(t,i,h)),a.updateImmediateChild(t,i);{r?.trackChildChange(Mt(t,h));let E=a.updateImmediateChild(t,m.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r?.trackChildChange(rt(d.name,d.node)),E.updateImmediateChild(d.name,d.node)):E}}else return i.isEmpty()?e:u&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Mt(c.name,c.node)),r.trackChildChange(rt(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,m.EMPTY_NODE)):e}};var Wt=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=k}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Se}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:pe}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===k}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function vu(n){return n.loadsAllData()?new Lt(n.getIndex()):n.hasLimit()?new ns(n):new In(n)}function wu(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Eu(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function is(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Cu(n,e,t){let i;return n.index_===le||t?i=is(n,e,t):i=is(n,e,pe),i.startAfterSet_=!0,i}function ss(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function Tu(n,e,t){let i;return n.index_===le||t?i=ss(n,e,t):i=ss(n,e,Se),i.endBeforeSet_=!0,i}function Hn(n,e){let t=n.copy();return t.index_=e,t}function xo(n){let e={};if(n.isDefault())return e;let t;if(n.index_===k?t="$priority":n.index_===Qs?t="$value":n.index_===le?t="$key":(f(n.index_ instanceof Ot,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=P(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=P(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+P(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=P(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+P(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Do(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==k&&(e.i=n.index_.toString()),e}var rs=class n extends vn{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=zt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let l=xo(e._queryParams);this.restRequest_(r+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(r,h,!1,i),ve(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",s(d,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=xo(e._queryParams),i=e._path.toString(),s=new D;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+zr(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=on(a.responseText)}catch{F("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&F("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var os=class{constructor(){this.rootNode_=m.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Sn(){return{value:null,children:new Map}}function ht(n,e,t){if(v(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=y(e);n.children.has(i)||n.children.set(i,Sn());let s=n.children.get(i);e=b(e),ht(s,e,t)}}function as(n,e){if(v(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(k,(i,s)=>{ht(n,new I(i),s)}),as(n,e)}}else if(n.children.size>0){let t=y(e);return e=b(e),n.children.has(t)&&as(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function ls(n,e,t){n.value!==null?t(e,n.value):Iu(n,(i,s)=>{let r=new I(e.toString()+"/"+i);ls(s,r,t)})}function Iu(n,e){n.children.forEach((t,i)=>{e(i,t)})}var cs=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&M(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}};var Oo=10*1e3,Su=30*1e3,bu=5*60*1e3,us=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new cs(e);let i=Oo+(Su-Oo)*Math.random();kt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;M(e,(s,r)=>{r>0&&X(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),kt(this.reportStats_.bind(this),Math.floor(Math.random()*2*bu))}};var ae=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(ae||{});function Ys(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Xs(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Zs(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var hs=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=ae.ACK_USER_WRITE,this.source=Ys()}operationForChild(e){if(v(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new I(e));return new n(T(),t,this.revert)}}else return f(y(this.path)===e,"operationForChild called for unrelated child."),new n(b(this.path),this.affectedTree,this.revert)}};var bn=class n{constructor(e,t){this.source=e,this.path=t,this.type=ae.LISTEN_COMPLETE}operationForChild(e){return v(this.path)?new n(this.source,T()):new n(this.source,b(this.path))}};var ot=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=ae.OVERWRITE}operationForChild(e){return v(this.path)?new n(this.source,T(),this.snap.getImmediateChild(e)):new n(this.source,b(this.path),this.snap)}};var Ut=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=ae.MERGE}operationForChild(e){if(v(this.path)){let t=this.children.subtree(new I(e));return t.isEmpty()?null:t.value?new ot(this.source,T(),t.value):new n(this.source,T(),t)}else return f(y(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,b(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var ue=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(v(e))return this.isFullyInitialized()&&!this.filtered_;let t=y(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var ds=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function ku(n,e,t,i){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(yu(o.childName,o.snapshotNode))}),bt(n,s,"child_removed",e,i,t),bt(n,s,"child_added",e,i,t),bt(n,s,"child_moved",r,i,t),bt(n,s,"child_changed",e,i,t),bt(n,s,"value",e,i,t),s}function bt(n,e,t,i,s,r){let o=i.filter(a=>a.type===t);o.sort((a,l)=>Ru(n,a,l)),o.forEach(a=>{let l=Au(n,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function Au(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Ru(n,e,t){if(e.childName==null||t.childName==null)throw ze("Should only compare child_ events.");let i=new w(e.childName,e.snapshotNode),s=new w(t.childName,t.snapshotNode);return n.index_.compare(i,s)}function Gn(n,e){return{eventCache:n,serverCache:e}}function Rt(n,e,t,i){return Gn(new ue(e,t,i),n.serverCache)}function Ta(n,e,t,i){return Gn(n.eventCache,new ue(e,t,i))}function kn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function We(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Oi,Nu=()=>(Oi||(Oi=new J(Ac)),Oi),U=class n{constructor(e,t=Nu()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return M(e,(i,s)=>{t=t.set(new I(i),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:T(),value:this.value};if(v(e))return null;{let i=y(e),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(b(e),t);return r!=null?{path:R(new I(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(v(e))return this;{let t=y(e),i=this.children.get(t);return i!==null?i.subtree(b(e)):new n(null)}}set(e,t){if(v(e))return new n(t,this.children);{let i=y(e),r=(this.children.get(i)||new n(null)).set(b(e),t),o=this.children.insert(i,r);return new n(this.value,o)}}remove(e){if(v(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=y(e),i=this.children.get(t);if(i){let s=i.remove(b(e)),r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(e){if(v(e))return this.value;{let t=y(e),i=this.children.get(t);return i?i.get(b(e)):null}}setTree(e,t){if(v(e))return t;{let i=y(e),r=(this.children.get(i)||new n(null)).setTree(b(e),t),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new n(this.value,o)}}fold(e){return this.fold_(T(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(R(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,T(),t)}findOnPath_(e,t,i){let s=this.value?i(t,this.value):!1;if(s)return s;if(v(e))return null;{let r=y(e),o=this.children.get(r);return o?o.findOnPath_(b(e),R(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,T(),t)}foreachOnPath_(e,t,i){if(v(e))return this;{this.value&&i(t,this.value);let s=y(e),r=this.children.get(s);return r?r.foreachOnPath_(b(e),R(t,s),i):new n(null)}}foreach(e){this.foreach_(T(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(R(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var se=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new U(null))}};function Nt(n,e,t){if(v(e))return new se(new U(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let s=i.path,r=i.value,o=W(s,e);return r=r.updateChild(o,t),new se(n.writeTree_.set(s,r))}else{let s=new U(t),r=n.writeTree_.setTree(e,s);return new se(r)}}}function fs(n,e,t){let i=n;return M(t,(s,r)=>{i=Nt(i,R(e,s),r)}),i}function Mo(n,e){if(v(e))return se.empty();{let t=n.writeTree_.setTree(e,new U(null));return new se(t)}}function _s(n,e){return Be(n,e)!=null}function Be(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(W(t.path,e)):null}function Fo(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(k,(i,s)=>{e.push(new w(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new w(i,s.value))}),e}function Te(n,e){if(v(e))return n;{let t=Be(n,e);return t!=null?new se(new U(t)):new se(n.writeTree_.subtree(e))}}function ps(n){return n.writeTree_.isEmpty()}function at(n,e){return Ia(T(),n.writeTree_,e)}function Ia(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(f(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=Ia(R(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(R(n,".priority"),i)),t}}function Kn(n,e){return Aa(e,n)}function Pu(n,e,t,i,s){f(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=Nt(n.visibleWrites,e,t)),n.lastWriteId=i}function xu(n,e,t,i){f(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=fs(n.visibleWrites,e,t),n.lastWriteId=i}function Du(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function Ou(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);f(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&Mu(a,i.path)?s=!1:Z(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return Fu(n),!0;if(i.snap)n.visibleWrites=Mo(n.visibleWrites,i.path);else{let a=i.children;M(a,l=>{n.visibleWrites=Mo(n.visibleWrites,R(i.path,l))})}return!0}else return!1}function Mu(n,e){if(n.snap)return Z(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Z(R(n.path,t),e))return!0;return!1}function Fu(n){n.visibleWrites=Sa(n.allWrites,Lu,T()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Lu(n){return n.visible}function Sa(n,e,t){let i=se.empty();for(let s=0;s<n.length;++s){let r=n[s];if(e(r)){let o=r.path,a;if(r.snap)Z(t,o)?(a=W(t,o),i=Nt(i,a,r.snap)):Z(o,t)&&(a=W(o,t),i=Nt(i,T(),r.snap.getChild(a)));else if(r.children){if(Z(t,o))a=W(t,o),i=fs(i,a,r.children);else if(Z(o,t))if(a=W(o,t),v(a))i=fs(i,T(),r.children);else{let l=ve(r.children,y(a));if(l){let c=l.getChild(b(a));i=Nt(i,T(),c)}}}else throw ze("WriteRecord should have .snap or .children")}}return i}function ba(n,e,t,i,s){if(!i&&!s){let r=Be(n.visibleWrites,e);if(r!=null)return r;{let o=Te(n.visibleWrites,e);if(ps(o))return t;if(t==null&&!_s(o,T()))return null;{let a=t||m.EMPTY_NODE;return at(o,a)}}}else{let r=Te(n.visibleWrites,e);if(!s&&ps(r))return t;if(!s&&t==null&&!_s(r,T()))return null;{let o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(Z(c.path,e)||Z(e,c.path))},a=Sa(n.allWrites,o,e),l=t||m.EMPTY_NODE;return at(a,l)}}}function Wu(n,e,t){let i=m.EMPTY_NODE,s=Be(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(k,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){let r=Te(n.visibleWrites,e);return t.forEachChild(k,(o,a)=>{let l=at(Te(r,new I(o)),a);i=i.updateImmediateChild(o,l)}),Fo(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=Te(n.visibleWrites,e);return Fo(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Uu(n,e,t,i,s){f(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=R(e,t);if(_s(n.visibleWrites,r))return null;{let o=Te(n.visibleWrites,r);return ps(o)?s.getChild(t):at(o,s.getChild(t))}}function Bu(n,e,t,i){let s=R(e,t),r=Be(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){let o=Te(n.visibleWrites,s);return at(o,i.getNode().getImmediateChild(t))}else return null}function ju(n,e){return Be(n.visibleWrites,e)}function Vu(n,e,t,i,s,r,o){let a,l=Te(n.visibleWrites,e),c=Be(l,T());if(c!=null)a=c;else if(t!=null)a=at(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),d=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),_=d.getNext();for(;_&&u.length<s;)h(_,i)!==0&&u.push(_),_=d.getNext();return u}else return[]}function Hu(){return{visibleWrites:se.empty(),allWrites:[],lastWriteId:-1}}function An(n,e,t,i){return ba(n.writeTree,n.treePath,e,t,i)}function Js(n,e){return Wu(n.writeTree,n.treePath,e)}function Lo(n,e,t,i){return Uu(n.writeTree,n.treePath,e,t,i)}function Rn(n,e){return ju(n.writeTree,R(n.treePath,e))}function Gu(n,e,t,i,s,r){return Vu(n.writeTree,n.treePath,e,t,i,s,r)}function er(n,e,t){return Bu(n.writeTree,n.treePath,e,t)}function ka(n,e){return Aa(R(n.treePath,e),n.writeTree)}function Aa(n,e){return{treePath:n,writeTree:e}}var gs=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;f(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),f(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,Ft(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,Mt(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,rt(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,Ft(i,e.snapshotNode,s.oldSnap));else throw ze("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var ms=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},Ra=new ms,Bt=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new ue(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return er(this.writes_,e,i)}}getChildAfterChild(e,t,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:We(this.viewCache_),r=Gu(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}};function Ku(n){return{filter:n}}function $u(n,e){f(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function zu(n,e,t,i,s){let r=new gs,o,a;if(t.type===ae.OVERWRITE){let c=t;c.source.fromUser?o=ys(n,e,c.path,c.snap,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!v(c.path),o=Nn(n,e,c.path,c.snap,i,s,a,r))}else if(t.type===ae.MERGE){let c=t;c.source.fromUser?o=Qu(n,e,c.path,c.children,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=vs(n,e,c.path,c.children,i,s,a,r))}else if(t.type===ae.ACK_USER_WRITE){let c=t;c.revert?o=Zu(n,e,c.path,i,s,r):o=Yu(n,e,c.path,c.affectedTree,i,s,r)}else if(t.type===ae.LISTEN_COMPLETE)o=Xu(n,e,t.path,i,r);else throw ze("Unknown operation type: "+t.type);let l=r.getChanges();return qu(e,o,l),{viewCache:o,changes:l}}function qu(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=kn(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(Ca(kn(e)))}}function Na(n,e,t,i,s,r){let o=e.eventCache;if(Rn(i,t)!=null)return e;{let a,l;if(v(t))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=We(e),u=c instanceof m?c:m.EMPTY_NODE,h=Js(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{let c=An(i,We(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=y(t);if(c===".priority"){f(be(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let h=Lo(i,t,u,l);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{let u=b(t),h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let d=Lo(i,t,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=er(i,c,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),c,h,u,s,r):a=o.getNode()}}return Rt(e,a,o.isFullyInitialized()||v(t),n.filter.filtersNodes())}}function Nn(n,e,t,i,s,r,o,a){let l=e.serverCache,c,u=o?n.filter:n.filter.getIndexedFilter();if(v(t))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){let _=l.getNode().updateChild(t,i);c=u.updateFullNode(l.getNode(),_,null)}else{let _=y(t);if(!l.isCompleteForPath(t)&&be(t)>1)return e;let p=b(t),S=l.getNode().getImmediateChild(_).updateChild(p,i);_===".priority"?c=u.updatePriority(l.getNode(),S):c=u.updateChild(l.getNode(),_,S,p,Ra,null)}let h=Ta(e,c,l.isFullyInitialized()||v(t),u.filtersNodes()),d=new Bt(s,h,r);return Na(n,h,t,s,d,a)}function ys(n,e,t,i,s,r,o){let a=e.eventCache,l,c,u=new Bt(s,e,r);if(v(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=Rt(e,c,!0,n.filter.filtersNodes());else{let h=y(t);if(h===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),i),l=Rt(e,c,a.isFullyInitialized(),a.isFiltered());else{let d=b(t),_=a.getNode().getImmediateChild(h),p;if(v(d))p=i;else{let E=u.getCompleteChild(h);E!=null?Ks(d)===".priority"&&E.getChild(ga(d)).isEmpty()?p=E:p=E.updateChild(d,i):p=m.EMPTY_NODE}if(_.equals(p))l=e;else{let E=n.filter.updateChild(a.getNode(),h,p,d,u,o);l=Rt(e,E,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function Wo(n,e){return n.eventCache.isCompleteForChild(e)}function Qu(n,e,t,i,s,r,o){let a=e;return i.foreach((l,c)=>{let u=R(t,l);Wo(e,y(u))&&(a=ys(n,a,u,c,s,r,o))}),i.foreach((l,c)=>{let u=R(t,l);Wo(e,y(u))||(a=ys(n,a,u,c,s,r,o))}),a}function Uo(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function vs(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;v(t)?c=i:c=new U(null).setTree(t,i);let u=e.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){let _=e.serverCache.getNode().getImmediateChild(h),p=Uo(n,_,d);l=Nn(n,l,new I(h),p,s,r,o,a)}}),c.children.inorderTraversal((h,d)=>{let _=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!_){let p=e.serverCache.getNode().getImmediateChild(h),E=Uo(n,p,d);l=Nn(n,l,new I(h),E,s,r,o,a)}}),l}function Yu(n,e,t,i,s,r,o){if(Rn(s,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(v(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Nn(n,e,t,l.getNode().getChild(t),s,r,a,o);if(v(t)){let c=new U(null);return l.getNode().forEachChild(le,(u,h)=>{c=c.set(new I(u),h)}),vs(n,e,t,c,s,r,a,o)}else return e}else{let c=new U(null);return i.foreach((u,h)=>{let d=R(t,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),vs(n,e,t,c,s,r,a,o)}}function Xu(n,e,t,i,s){let r=e.serverCache,o=Ta(e,r.getNode(),r.isFullyInitialized()||v(t),r.isFiltered());return Na(n,o,t,i,Ra,s)}function Zu(n,e,t,i,s,r){let o;if(Rn(i,t)!=null)return e;{let a=new Bt(i,e,s),l=e.eventCache.getNode(),c;if(v(t)||y(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=An(i,We(e));else{let h=e.serverCache.getNode();f(h instanceof m,"serverChildren would be complete if leaf node"),u=Js(i,h)}u=u,c=n.filter.updateFullNode(l,u,r)}else{let u=y(t),h=er(i,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=n.filter.updateChild(l,u,h,b(t),a,r):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,m.EMPTY_NODE,b(t),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=An(i,We(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Rn(i,T())!=null,Rt(e,c,o,n.filter.filtersNodes())}}var ws=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,s=new Lt(i.getIndex()),r=vu(i);this.processor_=Ku(r);let o=t.serverCache,a=t.eventCache,l=s.updateFullNode(m.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(m.EMPTY_NODE,a.getNode(),null),u=new ue(l,o.isFullyInitialized(),s.filtersNodes()),h=new ue(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Gn(h,u),this.eventGenerator_=new ds(this.query_)}get query(){return this.query_}};function Ju(n){return n.viewCache_.serverCache.getNode()}function eh(n){return kn(n.viewCache_)}function th(n,e){let t=We(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!v(e)&&!t.getImmediateChild(y(e)).isEmpty())?t.getChild(e):null}function Bo(n){return n.eventRegistrations_.length===0}function nh(n,e){n.eventRegistrations_.push(e)}function jo(n,e,t){let i=[];if(t){f(e==null,"A cancel should cancel all event registrations.");let s=n.query._path;n.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){let o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Vo(n,e,t,i){e.type===ae.MERGE&&e.source.queryId!==null&&(f(We(n.viewCache_),"We should always have a full cache before handling merges"),f(kn(n.viewCache_),"Missing event cache, even though we have a server cache"));let s=n.viewCache_,r=zu(n.processor_,s,e,t,i);return $u(n.processor_,r.viewCache),f(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Pa(n,r.changes,r.viewCache.eventCache.getNode(),null)}function ih(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(k,(r,o)=>{i.push(rt(r,o))}),t.isFullyInitialized()&&i.push(Ca(t.getNode())),Pa(n,i,t.getNode(),e)}function Pa(n,e,t,i){let s=i?[i]:n.eventRegistrations_;return ku(n.eventGenerator_,e,t,s)}var Pn,xn=class{constructor(){this.views=new Map}};function sh(n){f(!Pn,"__referenceConstructor has already been defined"),Pn=n}function rh(){return f(Pn,"Reference.ts has not been loaded"),Pn}function oh(n){return n.views.size===0}function tr(n,e,t,i){let s=e.source.queryId;if(s!==null){let r=n.views.get(s);return f(r!=null,"SyncTree gave us an op for an invalid query."),Vo(r,e,t,i)}else{let r=[];for(let o of n.views.values())r=r.concat(Vo(o,e,t,i));return r}}function xa(n,e,t,i,s){let r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=An(t,s?i:null),l=!1;a?l=!0:i instanceof m?(a=Js(t,i),l=!1):(a=m.EMPTY_NODE,l=!1);let c=Gn(new ue(a,l,!1),new ue(i,s,!1));return new ws(e,c)}return o}function ah(n,e,t,i,s,r){let o=xa(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),nh(o,t),ih(o,t)}function lh(n,e,t,i){let s=e._queryIdentifier,r=[],o=[],a=ke(n);if(s==="default")for(let[l,c]of n.views.entries())o=o.concat(jo(c,t,i)),Bo(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=n.views.get(s);l&&(o=o.concat(jo(l,t,i)),Bo(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!ke(n)&&r.push(new(rh())(e._repo,e._path)),{removed:r,events:o}}function Da(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Ie(n,e){let t=null;for(let i of n.views.values())t=t||th(i,e);return t}function Oa(n,e){if(e._queryParams.loadsAllData())return $n(n);{let i=e._queryIdentifier;return n.views.get(i)}}function Ma(n,e){return Oa(n,e)!=null}function ke(n){return $n(n)!=null}function $n(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Dn;function ch(n){f(!Dn,"__referenceConstructor has already been defined"),Dn=n}function uh(){return f(Dn,"Reference.ts has not been loaded"),Dn}var hh=1,On=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new U(null),this.pendingWriteTree_=Hu(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function nr(n,e,t,i,s){return Pu(n.pendingWriteTree_,e,t,i,s),s?dt(n,new ot(Ys(),e,t)):[]}function dh(n,e,t,i){xu(n.pendingWriteTree_,e,t,i);let s=U.fromObject(t);return dt(n,new Ut(Ys(),e,s))}function Ce(n,e,t=!1){let i=Du(n.pendingWriteTree_,e);if(Ou(n.pendingWriteTree_,e)){let r=new U(null);return i.snap!=null?r=r.set(T(),!0):M(i.children,o=>{r=r.set(new I(o),!0)}),dt(n,new hs(i.path,r,t))}else return[]}function Qt(n,e,t){return dt(n,new ot(Xs(),e,t))}function fh(n,e,t){let i=U.fromObject(t);return dt(n,new Ut(Xs(),e,i))}function _h(n,e){return dt(n,new bn(Xs(),e))}function ph(n,e,t){let i=ir(n,t);if(i){let s=sr(i),r=s.path,o=s.queryId,a=W(r,e),l=new bn(Zs(o),a);return rr(n,r,l)}else return[]}function Mn(n,e,t,i,s=!1){let r=e._path,o=n.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||Ma(o,e))){let l=lh(o,e,t,i);oh(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!s){let u=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(r,(d,_)=>ke(_));if(u&&!h){let d=n.syncPointTree_.subtree(r);if(!d.isEmpty()){let _=yh(d);for(let p=0;p<_.length;++p){let E=_[p],S=E.query,H=Ua(n,E);n.listenProvider_.startListening(Pt(S),jt(n,S),H.hashFn,H.onComplete)}}}!h&&c.length>0&&!i&&(u?n.listenProvider_.stopListening(Pt(e),null):c.forEach(d=>{let _=n.queryToTagMap.get(qn(d));n.listenProvider_.stopListening(Pt(d),_)}))}vh(n,c)}return a}function Fa(n,e,t,i){let s=ir(n,i);if(s!=null){let r=sr(s),o=r.path,a=r.queryId,l=W(o,e),c=new ot(Zs(a),l,t);return rr(n,o,c)}else return[]}function gh(n,e,t,i){let s=ir(n,i);if(s){let r=sr(s),o=r.path,a=r.queryId,l=W(o,e),c=U.fromObject(t),u=new Ut(Zs(a),l,c);return rr(n,o,u)}else return[]}function Es(n,e,t,i=!1){let s=e._path,r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(d,_)=>{let p=W(d,s);r=r||Ie(_,p),o=o||ke(_)});let a=n.syncPointTree_.get(s);a?(o=o||ke(a),r=r||Ie(a,T())):(a=new xn,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;r!=null?l=!0:(l=!1,r=m.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((_,p)=>{let E=Ie(p,T());E&&(r=r.updateImmediateChild(_,E))}));let c=Ma(a,e);if(!c&&!e._queryParams.loadsAllData()){let d=qn(e);f(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");let _=wh();n.queryToTagMap.set(d,_),n.tagToQueryMap.set(_,d)}let u=Kn(n.pendingWriteTree_,s),h=ah(a,e,t,u,r,l);if(!c&&!o&&!i){let d=Oa(a,e);h=h.concat(Eh(n,e,d))}return h}function zn(n,e,t){let s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=W(o,e),c=Ie(a,l);if(c)return c});return ba(s,e,r,t,!0)}function mh(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{let h=W(c,t);i=i||Ie(u,h)});let s=n.syncPointTree_.get(t);s?i=i||Ie(s,T()):(s=new xn,n.syncPointTree_=n.syncPointTree_.set(t,s));let r=i!=null,o=r?new ue(i,!0,!1):null,a=Kn(n.pendingWriteTree_,e._path),l=xa(s,e,a,r?o.getNode():m.EMPTY_NODE,r);return eh(l)}function dt(n,e){return La(e,n.syncPointTree_,null,Kn(n.pendingWriteTree_,T()))}function La(n,e,t,i){if(v(n.path))return Wa(n,e,t,i);{let s=e.get(T());t==null&&s!=null&&(t=Ie(s,T()));let r=[],o=y(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=ka(i,o);r=r.concat(La(a,l,c,u))}return s&&(r=r.concat(tr(s,n,i,t))),r}}function Wa(n,e,t,i){let s=e.get(T());t==null&&s!=null&&(t=Ie(s,T()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=ka(i,o),u=n.operationForChild(o);u&&(r=r.concat(Wa(u,a,l,c)))}),s&&(r=r.concat(tr(s,n,i,t))),r}function Ua(n,e){let t=e.query,i=jt(n,t);return{hashFn:()=>(Ju(e)||m.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?ph(n,t._path,i):_h(n,t._path);{let r=Pc(s,t);return Mn(n,t,null,r)}}}}function jt(n,e){let t=qn(e);return n.queryToTagMap.get(t)}function qn(n){return n._path.toString()+"$"+n._queryIdentifier}function ir(n,e){return n.tagToQueryMap.get(e)}function sr(n){let e=n.indexOf("$");return f(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new I(n.substr(0,e))}}function rr(n,e,t){let i=n.syncPointTree_.get(e);f(i,"Missing sync point for query tag that we're tracking");let s=Kn(n.pendingWriteTree_,e);return tr(i,t,s,null)}function yh(n){return n.fold((e,t,i)=>{if(t&&ke(t))return[$n(t)];{let s=[];return t&&(s=Da(t)),M(i,(r,o)=>{s=s.concat(o)}),s}})}function Pt(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(uh())(n._repo,n._path):n}function vh(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let s=qn(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function wh(){return hh++}function Eh(n,e,t){let i=e._path,s=jt(n,e),r=Ua(n,t),o=n.listenProvider_.startListening(Pt(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)f(!ke(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,h)=>{if(!v(c)&&u&&ke(u))return[$n(u).query];{let d=[];return u&&(d=d.concat(Da(u).map(_=>_.query))),M(h,(_,p)=>{d=d.concat(p)}),d}});for(let c=0;c<l.length;++c){let u=l[c];n.listenProvider_.stopListening(Pt(u),jt(n,u))}}return o}var Cs=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Ts=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=R(this.path_,e);return new n(this.syncTree_,t)}node(){return zn(this.syncTree_,this.path_)}},Ch=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Ho=function(n,e,t){if(!n||typeof n!="object")return n;if(f(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Th(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Ih(n[".sv"],e);f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Th=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:f(!1,"Unexpected server value: "+n)}},Ih=function(n,e,t){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&f(!1,"Unexpected increment value: "+i);let s=e.node();if(f(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},Ba=function(n,e,t,i){return ar(e,new Ts(t,n),i)},or=function(n,e,t){return ar(n,new Cs(e),t)};function ar(n,e,t){let i=n.getPriority().val(),s=Ho(i,e.getImmediateChild(".priority"),t),r;if(n.isLeafNode()){let o=n,a=Ho(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new it(a,N(s)):n}else{let o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new it(s))),o.forEachChild(k,(a,l)=>{let c=ar(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var Vt=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function Qn(n,e){let t=e instanceof I?e:new I(e),i=n,s=y(t);for(;s!==null;){let r=ve(i.node.children,s)||{children:{},childCount:0};i=new Vt(s,i,r),t=b(t),s=y(t)}return i}function je(n){return n.node.value}function lr(n,e){n.node.value=e,Is(n)}function ja(n){return n.node.childCount>0}function Sh(n){return je(n)===void 0&&!ja(n)}function Yn(n,e){M(n.node.children,(t,i)=>{e(new Vt(t,n,i))})}function Va(n,e,t,i){t&&!i&&e(n),Yn(n,s=>{Va(s,e,!0,i)}),t&&i&&e(n)}function bh(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Yt(n){return new I(n.parent===null?n.name:Yt(n.parent)+"/"+n.name)}function Is(n){n.parent!==null&&kh(n.parent,n.name,n)}function kh(n,e,t){let i=Sh(t),s=X(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,Is(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,Is(n))}var Ah=/[\[\].#$\/\u0000-\u001F\u007F]/,Rh=/[\[\].#$\u0000-\u001F\u007F]/,Mi=10*1024*1024,Xn=function(n){return typeof n=="string"&&n.length!==0&&!Ah.test(n)},Ha=function(n){return typeof n=="string"&&n.length!==0&&!Rh.test(n)},Nh=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ha(n)},Ht=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Vn(n)||n&&typeof n=="object"&&X(n,".sv")},he=function(n,e,t,i){i&&e===void 0||Xt(j(n,"value"),e,t)},Xt=function(n,e,t){let i=t instanceof I?new qi(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Me(i));if(typeof e=="function")throw new Error(n+"contains a function "+Me(i)+" with contents = "+e.toString());if(Vn(e))throw new Error(n+"contains "+e.toString()+" "+Me(i));if(typeof e=="string"&&e.length>Mi/3&&vt(e)>Mi)throw new Error(n+"contains a string greater than "+Mi+" utf8 bytes "+Me(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(M(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Xn(o)))throw new Error(n+" contains an invalid key ("+o+") "+Me(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);ou(i,o),Xt(n,a,i),au(i)}),s&&r)throw new Error(n+' contains ".value" child '+Me(i)+" in addition to actual children.")}},Ph=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let r=Dt(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Xn(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(ru);let s=null;for(t=0;t<e.length;t++){if(i=e[t],s!==null&&Z(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},Ga=function(n,e,t,i){if(i&&e===void 0)return;let s=j(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];M(e,(o,a)=>{let l=new I(o);if(Xt(s,a,R(t,l)),Ks(l)===".priority"&&!Ht(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),Ph(s,r)},cr=function(n,e,t){if(!(t&&e===void 0)){if(Vn(e))throw new Error(j(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ht(e))throw new Error(j(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Zt=function(n,e,t,i){if(!(i&&t===void 0)&&!Xn(t))throw new Error(j(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},ft=function(n,e,t,i){if(!(i&&t===void 0)&&!Ha(t))throw new Error(j(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},xh=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),ft(n,e,t,i)},z=function(n,e){if(y(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Ka=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Xn(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Nh(t))throw new Error(j(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Ss=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Zn(n,e){let t=null;for(let i=0;i<e.length;i++){let s=e[i],r=s.getPath();t!==null&&!$s(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function $a(n,e,t){Zn(n,t),za(n,i=>$s(i,e))}function q(n,e,t){Zn(n,t),za(n,i=>Z(i,e)||Z(e,i))}function za(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let s=n.eventLists_[i];if(s){let r=s.path;e(r)?(Dh(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Dh(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();Le&&O("event: "+t.toString()),ut(i)}}}var qa="repo_interrupt",Oh=25,bs=class{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ss,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Sn(),this.transactionQueueTree_=new Vt,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Mh(n,e,t){if(n.stats_=Gs(n.repoInfo_),n.forceRestClient_||Mc())n.server_=new rs(n.repoInfo_,(i,s,r,o)=>{Go(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Ko(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{P(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new zs(n.repoInfo_,e,(i,s,r,o)=>{Go(n,i,s,r,o)},i=>{Ko(n,i)},i=>{Fh(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=Lc(n.repoInfo_,()=>new us(n.stats_,n.server_)),n.infoData_=new os,n.infoSyncTree_=new On({startListening:(i,s,r,o)=>{let a=[],l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=Qt(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),ur(n,"connected",!1),n.serverSyncTree_=new On({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,l)=>{let c=o(a,l);q(n.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function Qa(n){let t=n.infoData_.getNode(new I(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Jt(n){return Ch({timestamp:Qa(n)})}function Go(n,e,t,i,s){n.dataUpdateCount++;let r=new I(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){let l=yt(t,c=>N(c));o=gh(n.serverSyncTree_,r,l,s)}else{let l=N(t);o=Fa(n.serverSyncTree_,r,l,s)}else if(i){let l=yt(t,c=>N(c));o=fh(n.serverSyncTree_,r,l)}else{let l=N(t);o=Qt(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=lt(n,r)),q(n.eventQueue_,a,o)}function Ko(n,e){ur(n,"connected",e),e===!1&&Uh(n)}function Fh(n,e){M(e,(t,i)=>{ur(n,t,i)})}function ur(n,e,t){let i=new I("/.info/"+e),s=N(t);n.infoData_.updateSnapshot(i,s);let r=Qt(n.infoSyncTree_,i,s);q(n.eventQueue_,i,r)}function Jn(n){return n.nextWriteId_++}function Lh(n,e,t){let i=mh(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(s=>{let r=N(s).withIndex(e._queryParams.getIndex());Es(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Qt(n.serverSyncTree_,e._path,r);else{let a=jt(n.serverSyncTree_,e);o=Fa(n.serverSyncTree_,e._path,r,a)}return q(n.eventQueue_,e._path,o),Mn(n.serverSyncTree_,e,t,null,!0),r},s=>(_t(n,"get for query "+P(e)+" failed: "+s),Promise.reject(new Error(s))))}function hr(n,e,t,i,s){_t(n,"set",{path:e.toString(),value:t,priority:i});let r=Jt(n),o=N(t,i),a=zn(n.serverSyncTree_,e),l=or(o,a,r),c=Jn(n),u=nr(n.serverSyncTree_,e,l,c,!0);Zn(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,_)=>{let p=d==="ok";p||F("set at "+e+" failed: "+d);let E=Ce(n.serverSyncTree_,c,!p);q(n.eventQueue_,e,E),Ae(n,s,d,_)});let h=fr(n,e);lt(n,h),q(n.eventQueue_,h,[])}function Wh(n,e,t,i){_t(n,"update",{path:e.toString(),value:t});let s=!0,r=Jt(n),o={};if(M(t,(a,l)=>{s=!1,o[a]=Ba(R(e,a),N(l),n.serverSyncTree_,r)}),s)O("update() called with empty data.  Don't do anything."),Ae(n,i,"ok",void 0);else{let a=Jn(n),l=dh(n.serverSyncTree_,e,o,a);Zn(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{let h=c==="ok";h||F("update at "+e+" failed: "+c);let d=Ce(n.serverSyncTree_,a,!h),_=d.length>0?lt(n,e):e;q(n.eventQueue_,_,d),Ae(n,i,c,u)}),M(t,c=>{let u=fr(n,R(e,c));lt(n,u)}),q(n.eventQueue_,e,[])}}function Uh(n){_t(n,"onDisconnectEvents");let e=Jt(n),t=Sn();ls(n.onDisconnect_,T(),(s,r)=>{let o=Ba(s,r,n.serverSyncTree_,e);ht(t,s,o)});let i=[];ls(t,T(),(s,r)=>{i=i.concat(Qt(n.serverSyncTree_,s,r));let o=fr(n,s);lt(n,o)}),n.onDisconnect_=Sn(),q(n.eventQueue_,T(),i)}function Bh(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,s)=>{i==="ok"&&as(n.onDisconnect_,e),Ae(n,t,i,s)})}function $o(n,e,t,i){let s=N(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{r==="ok"&&ht(n.onDisconnect_,e,s),Ae(n,i,r,o)})}function jh(n,e,t,i,s){let r=N(t,i);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&ht(n.onDisconnect_,e,r),Ae(n,s,o,a)})}function Vh(n,e,t,i){if(an(t)){O("onDisconnect().update() called with empty data.  Don't do anything."),Ae(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{s==="ok"&&M(t,(o,a)=>{let l=N(a);ht(n.onDisconnect_,R(e,o),l)}),Ae(n,i,s,r)})}function Hh(n,e,t){let i;y(e._path)===".info"?i=Es(n.infoSyncTree_,e,t):i=Es(n.serverSyncTree_,e,t),$a(n.eventQueue_,e._path,i)}function ks(n,e,t){let i;y(e._path)===".info"?i=Mn(n.infoSyncTree_,e,t):i=Mn(n.serverSyncTree_,e,t),$a(n.eventQueue_,e._path,i)}function Ya(n){n.persistentConnection_&&n.persistentConnection_.interrupt(qa)}function Gh(n){n.persistentConnection_&&n.persistentConnection_.resume(qa)}function _t(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),O(t,...e)}function Ae(n,e,t,i){e&&ut(()=>{if(t==="ok")e(null);else{let s=(t||"error").toUpperCase(),r=s;i&&(r+=": "+i);let o=new Error(r);o.code=s,e(o)}})}function Kh(n,e,t,i,s,r){_t(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:Qo(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=dr(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Xt("transaction failed: Data returned ",l,o.path),o.status=0;let c=Qn(n.transactionQueueTree_,e),u=je(c)||[];u.push(o),lr(c,u);let h;typeof l=="object"&&l!==null&&X(l,".priority")?(h=ve(l,".priority"),f(Ht(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(zn(n.serverSyncTree_,e)||m.EMPTY_NODE).getPriority().val();let d=Jt(n),_=N(l,h),p=or(_,a,d);o.currentOutputSnapshotRaw=_,o.currentOutputSnapshotResolved=p,o.currentWriteId=Jn(n);let E=nr(n.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);q(n.eventQueue_,e,E),ei(n,n.transactionQueueTree_)}}function dr(n,e,t){return zn(n.serverSyncTree_,e,t)||m.EMPTY_NODE}function ei(n,e=n.transactionQueueTree_){if(e||ti(n,e),je(e)){let t=Za(n,e);f(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&$h(n,Yt(e),t)}else ja(e)&&Yn(e,t=>{ei(n,t)})}function $h(n,e,t){let i=t.map(c=>c.currentWriteId),s=dr(n,e,i),r=s,o=s.hash();for(let c=0;c<t.length;c++){let u=t[c];f(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=W(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{_t(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(Ce(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();ti(n,Qn(n.transactionQueueTree_,e)),ei(n,n.transactionQueueTree_),q(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)ut(h[d])}else{if(c==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{F("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}lt(n,e)}},o)}function lt(n,e){let t=Xa(n,e),i=Yt(t),s=Za(n,t);return zh(n,s,i),i}function zh(n,e,t){if(e.length===0)return;let i=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=W(t,l.path),u=!1,h;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,s=s.concat(Ce(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Oh)u=!0,h="maxretry",s=s.concat(Ce(n.serverSyncTree_,l.currentWriteId,!0));else{let d=dr(n,l.path,o);l.currentInputSnapshot=d;let _=e[a].update(d.val());if(_!==void 0){Xt("transaction failed: Data returned ",_,l.path);let p=N(_);typeof _=="object"&&_!=null&&X(_,".priority")||(p=p.updatePriority(d.getPriority()));let S=l.currentWriteId,H=Jt(n),G=or(p,d,H);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=G,l.currentWriteId=Jn(n),o.splice(o.indexOf(S),1),s=s.concat(nr(n.serverSyncTree_,l.path,G,l.currentWriteId,l.applyLocally)),s=s.concat(Ce(n.serverSyncTree_,S,!0))}else u=!0,h="nodata",s=s.concat(Ce(n.serverSyncTree_,l.currentWriteId,!0))}q(n.eventQueue_,t,s),s=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}ti(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)ut(i[a]);ei(n,n.transactionQueueTree_)}function Xa(n,e){let t,i=n.transactionQueueTree_;for(t=y(e);t!==null&&je(i)===void 0;)i=Qn(i,t),e=b(e),t=y(e);return i}function Za(n,e){let t=[];return Ja(n,e,t),t.sort((i,s)=>i.order-s.order),t}function Ja(n,e,t){let i=je(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);Yn(e,s=>{Ja(n,s,t)})}function ti(n,e){let t=je(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,lr(e,t.length>0?t:void 0)}Yn(e,i=>{ti(n,i)})}function fr(n,e){let t=Yt(Xa(n,e)),i=Qn(n.transactionQueueTree_,e);return bh(i,s=>{Fi(n,s)}),Fi(n,i),Va(i,s=>{Fi(n,s)}),t}function Fi(n,e){let t=je(e);if(t){let i=[],s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(f(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(f(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Ce(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?lr(e,void 0):t.length=r+1,q(n.eventQueue_,Yt(e),s);for(let o=0;o<i.length;o++)ut(i[o])}}function qh(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function Qh(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):F(`Invalid query segment '${t}' in query '${n}'`)}return e}var As=function(n,e){let t=Yh(n),i=t.namespace;t.domain==="firebase.com"&&ce(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&ce("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||bc();let s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new mn(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new I(t.pathString)}},Yh=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(s=qh(n.substring(u,h)));let d=Qh(n.substring(Math.min(n.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let _=e.slice(0,c);if(_.toLowerCase()==="localhost")t="localhost";else if(_.split(".").length<=2)t=_;else{let p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),t=e.substring(p+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};var zo="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Xh=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=zo.charAt(t%64),t=Math.floor(t/64);f(t===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=zo.charAt(e[s]);return f(o.length===20,"nextPushId: Length should be 20."),o}}();var Fn=class{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+P(this.snapshot.exportVal())}},Ln=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Gt=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Wn=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new D;return Bh(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){z("OnDisconnect.remove",this._path);let e=new D;return $o(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){z("OnDisconnect.set",this._path),he("OnDisconnect.set",e,this._path,!1);let t=new D;return $o(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){z("OnDisconnect.setWithPriority",this._path),he("OnDisconnect.setWithPriority",e,this._path,!1),cr("OnDisconnect.setWithPriority",t,!1);let i=new D;return jh(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){z("OnDisconnect.update",this._path),Ga("OnDisconnect.update",e,this._path,!1);let t=new D;return Vh(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var B=class n{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return v(this._path)?null:Ks(this._path)}get ref(){return new Q(this._repo,this._path)}get _queryIdentifier(){let e=Do(this._queryParams),t=Hs(e);return t==="{}"?"default":t}get _queryObject(){return Do(this._queryParams)}isEqual(e){if(e=L(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=$s(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+su(this._path)}};function ni(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Ne(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===le){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Se)throw new Error(i);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==pe)throw new Error(i);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===k){if(e!=null&&!Ht(e)||t!=null&&!Ht(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(n.getIndex()instanceof Ot||n.getIndex()===Qs,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function ii(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Q=class n extends B{constructor(e,t){super(e,t,new Wt,!1)}get parent(){let e=ga(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},ct=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new I(e),i=Re(this.ref,e);return new n(this._node.getChild(t),i,k)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new n(s,Re(this.ref,i),k)))}hasChild(e){let t=new I(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function _r(n,e){return n=L(n),n._checkNotDeleted("ref"),e!==void 0?Re(n._root,e):n._root}function pr(n,e){n=L(n),n._checkNotDeleted("refFromURL");let t=As(e,n._repo.repoInfo_.nodeAdmin);Ka("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&ce("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),_r(n,t.path.toString())}function Re(n,e){return n=L(n),y(n._path)===null?xh("child","path",e,!1):ft("child","path",e,!1),new Q(n._repo,R(n._path,e))}function el(n,e){n=L(n),z("push",n._path),he("push",e,n._path,!0);let t=Qa(n._repo),i=Xh(t),s=Re(n,i),r=Re(n,i),o;return e!=null?o=si(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function tl(n){return z("remove",n._path),si(n,null)}function si(n,e){n=L(n),z("set",n._path),he("set",e,n._path,!1);let t=new D;return hr(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function nl(n,e){n=L(n),z("setPriority",n._path),cr("setPriority",e,!1);let t=new D;return hr(n._repo,R(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function il(n,e,t){if(z("setWithPriority",n._path),he("setWithPriority",e,n._path,!1),cr("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new D;return hr(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function sl(n,e){Ga("update",e,n._path,!1);let t=new D;return Wh(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function rl(n){n=L(n);let e=new Gt(()=>{}),t=new Kt(e);return Lh(n._repo,n,t).then(i=>new ct(i,new Q(n._repo,n._path),n._queryParams.getIndex()))}var Kt=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Fn("value",this,new ct(e.snapshotNode,new Q(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ln(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Un=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ln(this,e,t):null}createEvent(e,t){f(e.childName!=null,"Child events should have a childName.");let i=Re(new Q(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new Fn(e.type,this,new ct(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function en(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){let l=t,c=(u,h)=>{ks(n._repo,n,a),l(u,h)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new Gt(t,r||void 0),a=e==="value"?new Kt(o):new Un(e,o);return Hh(n._repo,n,a),()=>ks(n._repo,n,a)}function ri(n,e,t,i){return en(n,"value",e,t,i)}function gr(n,e,t,i){return en(n,"child_added",e,t,i)}function mr(n,e,t,i){return en(n,"child_changed",e,t,i)}function yr(n,e,t,i){return en(n,"child_moved",e,t,i)}function vr(n,e,t,i){return en(n,"child_removed",e,t,i)}function wr(n,e,t){let i=null,s=t?new Gt(t):null;e==="value"?i=new Kt(s):e&&(i=new Un(e,s)),ks(n._repo,n,i)}var Y=class{},Bn=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){he("endAt",this._value,e._path,!0);let t=ss(e._queryParams,this._value,this._key);if(ii(t),Ne(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new B(e._repo,e._path,t,e._orderByCalled)}};function ol(n,e){return Zt("endAt","key",e,!0),new Bn(n,e)}var Rs=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){he("endBefore",this._value,e._path,!1);let t=Tu(e._queryParams,this._value,this._key);if(ii(t),Ne(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new B(e._repo,e._path,t,e._orderByCalled)}};function al(n,e){return Zt("endBefore","key",e,!0),new Rs(n,e)}var jn=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){he("startAt",this._value,e._path,!0);let t=is(e._queryParams,this._value,this._key);if(ii(t),Ne(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new B(e._repo,e._path,t,e._orderByCalled)}};function ll(n=null,e){return Zt("startAt","key",e,!0),new jn(n,e)}var Ns=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){he("startAfter",this._value,e._path,!1);let t=Cu(e._queryParams,this._value,this._key);if(ii(t),Ne(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new B(e._repo,e._path,t,e._orderByCalled)}};function cl(n,e){return Zt("startAfter","key",e,!0),new Ns(n,e)}var Ps=class extends Y{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new B(e._repo,e._path,wu(e._queryParams,this._limit),e._orderByCalled)}};function ul(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Ps(n)}var xs=class extends Y{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new B(e._repo,e._path,Eu(e._queryParams,this._limit),e._orderByCalled)}};function hl(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new xs(n)}var Ds=class extends Y{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){ni(e,"orderByChild");let t=new I(this._path);if(v(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new Ot(t),s=Hn(e._queryParams,i);return Ne(s),new B(e._repo,e._path,s,!0)}};function dl(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return ft("orderByChild","path",n,!1),new Ds(n)}var Os=class extends Y{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){ni(e,"orderByKey");let t=Hn(e._queryParams,le);return Ne(t),new B(e._repo,e._path,t,!0)}};function fl(){return new Os}var Ms=class extends Y{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){ni(e,"orderByPriority");let t=Hn(e._queryParams,k);return Ne(t),new B(e._repo,e._path,t,!0)}};function _l(){return new Ms}var Fs=class extends Y{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){ni(e,"orderByValue");let t=Hn(e._queryParams,Qs);return Ne(t),new B(e._repo,e._path,t,!0)}};function pl(){return new Fs}var Ls=class extends Y{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(he("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Bn(this._value,this._key)._apply(new jn(this._value,this._key)._apply(e))}};function gl(n,e){return Zt("equalTo","key",e,!0),new Ls(n,e)}function ee(n,...e){let t=L(n);for(let i of e)t=i._apply(t);return t}sh(Q);ch(Q);var Zh="FIREBASE_DATABASE_EMULATOR_HOST",Ws={},Jh=!1;function ed(n,e,t,i){n.repoInfo_=new mn(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function Er(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||ce("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),O("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=As(r,s),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Zh]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=As(r,s),a=o.repoInfo):l=!o.repoInfo.secure;let u=s&&l?new At(At.OWNER):new Vi(n.name,n.options,e);Ka("Invalid Firebase Database URL",o),v(o.path)||ce("Database URL must point to the root of a Firebase Database (not including a child path).");let h=nd(a,n,u,new ji(n.name,t));return new Us(h,n)}function td(n,e){let t=Ws[e];(!t||t[n.key]!==n)&&ce(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Ya(n),delete t[n.key]}function nd(n,e,t,i){let s=Ws[e.name];s||(s={},Ws[e.name]=s);let r=s[n.toURLString()];return r&&ce("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new bs(n,Jh,t,i),s[n.toURLString()]=r,r}var Us=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Mh(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Q(this._repo,T())),this._rootInternal}_delete(){return this._rootInternal!==null&&(td(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ce("Cannot call "+e+" on a deleted database.")}};function ml(){pa.IS_TRANSPORT_INITIALIZED&&F("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function yl(){ml(),xt.forceDisallow()}function vl(){ml(),Je.forceDisallow(),xt.forceAllow()}function wl(n,e,t,i={}){n=L(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&ce("Cannot call useEmulator() after instance has already been initialized.");let s=n._repoInternal,r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&ce('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new At(At.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:jr(i.mockUserToken,n.app.options.projectId);r=new At(o)}ed(s,e,t,r)}function El(n){n=L(n),n._checkNotDeleted("goOffline"),Ya(n._repo)}function Cl(n){n=L(n),n._checkNotDeleted("goOnline"),Gh(n._repo)}function Tl(n,e){Xo(n,e)}function id(n){Vs(Xr),wt(new fe("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Er(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),we(go,mo,n),we(go,mo,"esm2017")}var sd={".sv":"timestamp"};function Il(){return sd}function Sl(n){return{".sv":{increment:n}}}var Bs=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function bl(n,e,t){var i;if(n=L(n),z("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let s=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,r=new D,o=(l,c,u)=>{let h=null;l?r.reject(l):(h=new ct(u,new Q(n._repo,n._path),k),r.resolve(new Bs(c,h)))},a=ri(n,()=>{});return Kh(n._repo,n._path,e,o,a,s),r.promise}zs.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};zs.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};id();var rd="@firebase/database-compat",od="1.0.7";var ad=new qe("@firebase/database-compat"),kl=function(n){let e="FIREBASE WARNING: "+n;ad.warn(e)};var ld=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(j(n,e)+"must be a boolean.")},cd=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(j(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var Cr=class{constructor(e){this._delegate=e}cancel(e){g("OnDisconnect.cancel",0,1,arguments.length),x("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){g("OnDisconnect.remove",0,1,arguments.length),x("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){g("OnDisconnect.set",1,2,arguments.length),x("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){g("OnDisconnect.setWithPriority",2,3,arguments.length),x("OnDisconnect.setWithPriority","onComplete",i,!0);let s=this._delegate.setWithPriority(e,t);return i&&s.then(()=>i(null),r=>i(r)),s}update(e,t){if(g("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,kl("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}x("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),s=>t(s)),i}};var Tr=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return g("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Ve=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return g("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return g("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return g("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return g("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return g("DataSnapshot.child",0,1,arguments.length),e=String(e),ft("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return g("DataSnapshot.hasChild",1,1,arguments.length),ft("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return g("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return g("DataSnapshot.forEach",1,1,arguments.length),x("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return g("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return g("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return g("DataSnapshot.ref",0,0,arguments.length),new ge(this._database,this._delegate.ref)}get ref(){return this.getRef()}},oi=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,s){var r;g("Query.on",2,4,arguments.length),x("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,s),a=(c,u)=>{t.call(o.context,new Ve(this.database,c),u)};a.userCallback=t,a.context=o.context;let l=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return ri(this._delegate,a,l),t;case"child_added":return gr(this._delegate,a,l),t;case"child_removed":return vr(this._delegate,a,l),t;case"child_changed":return mr(this._delegate,a,l),t;case"child_moved":return yr(this._delegate,a,l),t;default:throw new Error(j("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(g("Query.off",0,3,arguments.length),cd("Query.off",e,!0),x("Query.off","callback",t,!0),fi("Query.off","context",i,!0),t){let s=()=>{};s.userCallback=t,s.context=i,wr(this._delegate,e,s)}else wr(this._delegate,e)}get(){return rl(this._delegate).then(e=>new Ve(this.database,e))}once(e,t,i,s){g("Query.once",1,4,arguments.length),x("Query.once","callback",t,!0);let r=n.getCancelAndContextArgs_("Query.once",i,s),o=new D,a=(c,u)=>{let h=new Ve(this.database,c);t&&t.call(r.context,h,u),o.resolve(h)};a.userCallback=t,a.context=r.context;let l=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":ri(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":gr(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":vr(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":mr(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":yr(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(j("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return g("Query.limitToFirst",1,1,arguments.length),new n(this.database,ee(this._delegate,ul(e)))}limitToLast(e){return g("Query.limitToLast",1,1,arguments.length),new n(this.database,ee(this._delegate,hl(e)))}orderByChild(e){return g("Query.orderByChild",1,1,arguments.length),new n(this.database,ee(this._delegate,dl(e)))}orderByKey(){return g("Query.orderByKey",0,0,arguments.length),new n(this.database,ee(this._delegate,fl()))}orderByPriority(){return g("Query.orderByPriority",0,0,arguments.length),new n(this.database,ee(this._delegate,_l()))}orderByValue(){return g("Query.orderByValue",0,0,arguments.length),new n(this.database,ee(this._delegate,pl()))}startAt(e=null,t){return g("Query.startAt",0,2,arguments.length),new n(this.database,ee(this._delegate,ll(e,t)))}startAfter(e=null,t){return g("Query.startAfter",0,2,arguments.length),new n(this.database,ee(this._delegate,cl(e,t)))}endAt(e=null,t){return g("Query.endAt",0,2,arguments.length),new n(this.database,ee(this._delegate,ol(e,t)))}endBefore(e=null,t){return g("Query.endBefore",0,2,arguments.length),new n(this.database,ee(this._delegate,al(e,t)))}equalTo(e,t){return g("Query.equalTo",1,2,arguments.length),new n(this.database,ee(this._delegate,gl(e,t)))}toString(){return g("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return g("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(g("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let s={cancel:void 0,context:void 0};if(t&&i)s.cancel=t,x(e,"cancel",s.cancel,!0),s.context=i,fi(e,"context",s.context,!0);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error(j(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new ge(this.database,new Q(this._delegate._repo,this._delegate._path))}},ge=class n extends oi{constructor(e,t){super(e,new B(t._repo,t._path,new Wt,!1)),this.database=e,this._delegate=t}getKey(){return g("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return g("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,Re(this._delegate,e))}getParent(){g("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return g("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){g("Reference.set",1,2,arguments.length),x("Reference.set","onComplete",t,!0);let i=si(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}update(e,t){if(g("Reference.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,kl("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}z("Reference.update",this._delegate._path),x("Reference.update","onComplete",t,!0);let i=sl(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){g("Reference.setWithPriority",2,3,arguments.length),x("Reference.setWithPriority","onComplete",i,!0);let s=il(this._delegate,e,t);return i&&s.then(()=>i(null),r=>i(r)),s}remove(e){g("Reference.remove",0,1,arguments.length),x("Reference.remove","onComplete",e,!0);let t=tl(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){g("Reference.transaction",1,3,arguments.length),x("Reference.transaction","transactionUpdate",e,!1),x("Reference.transaction","onComplete",t,!0),ld("Reference.transaction","applyLocally",i,!0);let s=bl(this._delegate,e,{applyLocally:i}).then(r=>new Tr(r.committed,new Ve(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){g("Reference.setPriority",1,2,arguments.length),x("Reference.setPriority","onComplete",t,!0);let i=nl(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}push(e,t){g("Reference.push",0,2,arguments.length),x("Reference.push","onComplete",t,!0);let i=el(this._delegate,e),s=i.then(o=>new n(this.database,o));t&&s.then(()=>t(null),o=>t(o));let r=new n(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return z("Reference.onDisconnect",this._delegate._path),new Cr(new Wn(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var He=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:yl,forceLongPolling:vl}}useEmulator(e,t,i={}){wl(this._delegate,e,t,i)}ref(e){if(g("database.ref",0,1,arguments.length),e instanceof ge){let t=pr(this._delegate,e.toString());return new ge(this,t)}else{let t=_r(this._delegate,e);return new ge(this,t)}}refFromURL(e){g("database.refFromURL",1,1,arguments.length);let i=pr(this._delegate,e);return new ge(this,i)}goOffline(){return g("database.goOffline",0,0,arguments.length),El(this._delegate)}goOnline(){return g("database.goOnline",0,0,arguments.length),Cl(this._delegate)}};He.ServerValue={TIMESTAMP:Il(),increment:n=>Sl(n)};function ud({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:s,namespace:r,nodeAdmin:o=!1}){Vs(t);let a=new _i("database-standalone"),l=new ln("auth-internal",a);l.setComponent(new fe("auth-internal",()=>i,"PRIVATE"));let c;return s&&(c=new ln("app-check-internal",a),c.setComponent(new fe("app-check-internal",()=>s,"PRIVATE"))),{instance:new He(Er(n,l,c,e,o),n),namespace:r}}var hd=Object.freeze({__proto__:null,initStandalone:ud});var dd=He.ServerValue;function fd(n){n.INTERNAL.registerComponent(new fe("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new He(s,i)},"PUBLIC").setServiceProps({Reference:ge,Query:oi,Database:He,DataSnapshot:Ve,enableLogging:Tl,INTERNAL:hd,ServerValue:dd}).setMultipleInstances(!0)),n.registerVersion(rd,od)}fd(V);function tn(n,e,t="on",i=sn){return new Ge(s=>{let r=null;return r=n[t](e,(o,a)=>{i.schedule(()=>{s.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>s.complete())},o=>{i.schedule(()=>s.error(o))}),t==="on"?{unsubscribe(){r!=null&&n.off(e,r)}}:{unsubscribe(){}}}).pipe(K(s=>{let{snapshot:r,prevKey:o}=s,a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),Pr())}function _d(n){return typeof n=="string"}function pd(n){return typeof n.exportVal=="function"}function xl(n){return n==null}function Dl(n){return typeof n.set=="function"}function Al(n,e){return Dl(e)?e:n.ref(e)}function Ol(n,e){if(_d(n))return e.stringCase();if(Dl(n))return e.firebaseCase();if(pd(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function Ml(n){return(xl(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Fl(n,e,t){e=Ml(e);let i=e.map(s=>tn(n,s,"on",t));return pt(...i)}function gd(n,e,t){let i=Fl(n,e).pipe(li((s,r)=>[...s,r],[]));return yd(n,i,t)}function md(n,e){return tn(n,"value","on",e).pipe(K(t=>{let i;return t.payload.forEach(s=>(i=s.key,!1)),{data:t,lastKeyToLoad:i}}))}function yd(n,e,t){return md(n,t).pipe(Or(e),K(([s,r])=>{let o=s.lastKeyToLoad,a=r.map(l=>l.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),xr(s=>s.loadedKeys.indexOf(s.lastKeyToLoad)===-1),K(s=>s.actions))}function Rl(n,e){return function(i,s){return Ol(i,{stringCase:()=>n.child(i)[e](s),firebaseCase:()=>i[e](s),snapshotCase:()=>i.ref[e](s)})}}function vd(n){return function(t){return t?Ol(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function wd(n,e,t){return tn(n,"value","once",t).pipe(de(i=>{let s=[De(i)];return e.forEach(r=>s.push(tn(n,r,"on",t))),pt(...s).pipe(li(Cd,[]))}),Rr())}function Ll(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function Ed(n,e){if(xl(e))return 0;{let t=Ll(n,e);return t===-1?n.length:t+1}}function Cd(n,e){let{payload:t,prevKey:i,key:s}=e,r=Ll(n,s),o=Ed(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(r>-1)(n[r-1]?.key||null)!==i&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===s?e:a);case"child_moved":if(r>-1){let a=n.splice(r,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function Nl(n,e,t){return e=Ml(e),wd(n,e,t)}function Td(n,e){let t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Rl(i,"update"),set:Rl(i,"set"),push:s=>i.push(s),remove:vd(i),snapshotChanges(s){return Nl(n,s,t).pipe(_e)},stateChanges(s){return Fl(n,s,t).pipe(_e)},auditTrail(s){return gd(n,s,t).pipe(_e)},valueChanges(s,r){return Nl(n,s,t).pipe(K(a=>a.map(l=>r&&r.idField?Sr(nn({},l.payload.val()),{[r.idField]:l.key}):l.payload.val())),_e)}}}function Pl(n,e){return function(){return tn(n,"value","on",e)}}function Id(n,e){return{query:n,snapshotChanges(){return Pl(n,e.schedulers.outsideAngular)().pipe(_e)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return Pl(n,e.schedulers.outsideAngular)().pipe(_e,K(i=>i.payload.exists()?i.payload.val():null))}}}var Sd=new $("angularfire2.realtimeDatabaseURL"),bd=new $("angularfire2.database.use-emulator"),Ir=(()=>{class n{schedulers;database;constructor(t,i,s,r,o,a,l,c,u,h,d,_,p,E,S){this.schedulers=a;let H=l,G=Et(t,o,i);c&&Ri(G,o,u,d,_,p,h,E),this.database=fn(`${G.name}.database.${s}`,"AngularFireDatabase",G.name,()=>{let A=o.runOutsideAngular(()=>G.database(s||void 0));return H&&A.useEmulator(...H),A},[H])}list(t,i){let s=this.schedulers.ngZone.runOutsideAngular(()=>Al(this.database,t)),r=s;return i&&(r=i(s)),Td(r,this)}object(t){let i=this.schedulers.ngZone.runOutsideAngular(()=>Al(this.database,t));return Id(i,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(C(Ye),C(Xe,8),C(Sd,8),C($e),C(ye),C(hn),C(bd,8),C(po,8),C(Ti,8),C(Ii,8),C(Si,8),C(bi,8),C(ki,8),C(Ai,8),C(Oe,8))};static \u0275prov=me({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),n_=(()=>{class n{constructor(){V.registerVersion("angularfire",Qe.full,"rtdb-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=mt({type:n});static \u0275inj=gt({providers:[Ir]})}return n})();var r_=(()=>{let e=class e{constructor(i){this.db=i,this.dbPath="/object",this.anysRef=i.list(this.dbPath)}searchByObjectName(i){return this.db.object("/object").snapshotChanges().pipe(K(s=>{let r=s.payload.val(),o=[];if(r)for(let a in r)r[a].ObjectDisplayName&&r[a].ObjectDisplayName.toLowerCase().includes(i.toLowerCase())&&o.push(nn({key:a},r[a]));return o}))}getAll(){return this.anysRef}create(i){return this.anysRef.push(i)}update(i,s){return this.anysRef.update(i,s)}delete(i){return this.anysRef.remove(i)}deleteAll(){return this.anysRef.remove()}};e.\u0275fac=function(s){return new(s||e)(C(Ir))},e.\u0275prov=me({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();export{Gd as a,n_ as b,r_ as c};
